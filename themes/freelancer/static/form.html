<html>
    <head>

        <script type="text/javascript">
              function setCookie(cname, cvalue, exdays = 7) {
                const d = new Date();
                d.setTime(d.getTime() + (exdays*24*60*60*1000));
                let expires = "expires="+ d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
              }
              function getCookie(name) {
                const cookie = {};
                document.cookie.split(';').forEach(function(el) {
                  let [key,value] = el.split('=');
                  cookie[key.trim()] = value;
                })
                return cookie[name] !== undefined ? JSON.parse(cookie[name]) : undefined;
            }
            function eraseCookie(name) {   
              document.cookie = name+'=; Max-Age=-99999999;';  
            }
            function setComment(name, value) {
                const comment = {name: document.getElementById('static_comment_name').value, comment: document.getElementById('static_comment').value, timestamp: Date.now(), id: uuidv4()};
                setCookie(location.pathname, JSON.stringify(comment));
            }
          
            function syncComment() {
                console.log('syncComment');
                const comment = getCookie(location.pathname);

                if (comment !== undefined) {
                  // comment in cookie
                  console.log(JSON.stringify(comment));
                  console.log(findComment(comment));

                  if (findComment(comment)) {
                    // comment in html
                    eraseCookie(location.pathname);
                  } else {
                    // comment not in html yet
                    var ul = document.getElementById('static_comments');
                    var li = document.createElement("li");
                    li.appendChild(document.createTextNode(comment.comment));
                    ul.appendChild(li);
                    document.getElementById('static_comment_form').remove();
                  }
                }
              }
              function findComment(comment) {
                return document.getElementById(comment.id) != undefined;
              }
              function uuidv4() {
                return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                  (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                );
              }
              window.onload = function(){
                syncComment();
              }
        </script>
    </head>
    <body>
        <h1>Lorem Ipsum</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis ipsum est, tempor lacinia tristique vitae, rutrum vel diam. Quisque eleifend accumsan mauris non hendrerit. Curabitur aliquam gravida enim, ac placerat nunc. Quisque lacus felis, sagittis a enim fringilla, maximus tincidunt dui. Praesent diam ipsum, tempus et facilisis sed, cursus eu enim. Donec eu aliquam leo. Ut iaculis cursus enim, ac bibendum risus porta et. Aliquam erat volutpat. Nulla commodo ante ac auctor tempor. Duis vitae pellentesque eros. Suspendisse sagittis, nunc tempus dictum imperdiet, nisi mi facilisis leo, vel vulputate erat dolor eget purus. Sed interdum eleifend convallis. Nullam gravida erat id sem ullamcorper, a ultricies turpis varius. Nam at interdum leo.</p>

        <ul id="static_comments">
          <li id="40fd99d3-8e63-4e89-8c5e-9242808d89cb">dummy</li>
        </ul>

        <form id="static_comment_form" onsubmit="setComment();">
          <textarea id="static_comment" name="comment" placeholder="Write some comment" required="true"></textarea>    
          <input id="static_comment_name" name="name" placeholder="Your name (this will be public)" type="text" required="true">    
          <button type="submit" >Comment</button>
        </form>

        <p>Nulla condimentum, erat vel mollis laoreet, elit dui tincidunt augue, at lobortis tortor lacus a tortor. Fusce non nisl aliquam, ullamcorper lorem vel, interdum velit. Donec erat diam, ullamcorper id scelerisque sed, interdum sed elit. Aliquam consectetur odio arcu, sed maximus nisl lobortis eu. Quisque et metus mi. Vivamus in sollicitudin lorem, eget efficitur odio. Etiam ornare convallis mauris vitae commodo. Maecenas lacus dolor, accumsan nec orci at, iaculis finibus orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Morbi massa erat, sagittis a ex eget, viverra interdum erat.</p>
    </body>
</html>